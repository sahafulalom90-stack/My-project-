<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shop Live Audio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: #fff;
      padding-top: 80px;
    }
    button {
      font-size: 20px;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      background: #00c853;
      color: white;
    }
    p {
      margin-top: 20px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

  <h2>ðŸŽ§ Shop Live Audio</h2>
  <button id="startBtn">Tap to Start Audio</button>
  <p id="status">Waitingâ€¦</p>

  <audio id="remoteAudio" autoplay playsinline></audio>

<script>
/* =======================
   ðŸ”¥ FIREBASE CONFIG
   ======================= */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* =======================
   ðŸŽ§ WEBRTC SETUP
   ======================= */
let pc;
const audio = document.getElementById("remoteAudio");
const statusText = document.getElementById("status");

const iceServers = {
  iceServers: [
    { urls: "stun:stun.l.google.com:19302" }
  ]
};

document.getElementById("startBtn").onclick = async () => {
  document.getElementById("startBtn").style.display = "none";
  statusText.innerText = "Connectingâ€¦";

  pc = new RTCPeerConnection(iceServers);

  pc.ontrack = (event) => {
    audio.srcObject = event.streams[0];
    statusText.innerText = "ðŸ”Š Live audio connected";
  };

  pc.onicecandidate = (event) => {
    if (event.candidate) {
      db.ref("webrtc/answerCandidates").push(JSON.stringify(event.candidate));
    }
  };

  /* ===== listen OFFER ===== */
  db.ref("webrtc/offer").once("value", async snap => {
    const offer = snap.val();
    if (!offer) {
      statusText.innerText = "No live audio available";
      return;
    }

    await pc.setRemoteDescription(new RTCSessionDescription(JSON.parse(offer)));
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);

    db.ref("webrtc/answer").set(JSON.stringify(answer));
  });

  /* ===== listen ICE from Android ===== */
  db.ref("webrtc/offerCandidates").on("child_added", snap => {
    const candidate = JSON.parse(snap.val());
    pc.addIceCandidate(new RTCIceCandidate(candidate));
  });
};
</script>

</body>
</html>
