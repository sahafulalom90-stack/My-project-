<!DOCTYPE html>
<html>
<head>
    <title>Audio Monitor - Receiver</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
    <h2>Store Audio Monitor (Live)</h2>
    <button id="listenBtn" style="padding: 20px; background: green; color: white; border-radius: 10px;">START LISTENING</button>
    <div id="status" style="margin-top: 20px; font-weight: bold;">Status: Waiting...</div>
    <audio id="remoteAudio" autoplay controls style="margin-top: 20px;"></audio>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyBGnVbP3NoTNtShKrYBCcb58ki1faBZeTI",
          authDomain: "audiomonitor-1bc41.firebaseapp.com",
          databaseURL: "https://audiomonitor-1bc41-default-rtdb.firebaseio.com",
          projectId: "audiomonitor-1bc41",
          storageBucket: "audiomonitor-1bc41.firebasestorage.app",
          messagingSenderId: "75285264458",
          appId: "1:75285264458:web:1b4cf59f3397fbc8b0ceb3"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const pc = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        pc.ontrack = (event) => {
            document.getElementById('remoteAudio').srcObject = event.streams[0];
            document.getElementById('status').innerText = "Status: Connected - Listening Live!";
        };

        document.getElementById('listenBtn').onclick = async () => {
            document.getElementById('status').innerText = "Status: Calling Store Phone...";
            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);
            database.ref('calls/store').set({ offer: offer.sdp });
        };

        database.ref('calls/store/answer').on('value', async (snapshot) => {
            const answer = snapshot.val();
            if (answer) {
                await pc.setRemoteDescription(new RTCSessionDescription({ type: 'answer', sdp: answer }));
            }
        });
    </script>
</body>
</html>
